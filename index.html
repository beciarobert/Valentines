<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Valentine</title>

  <style>
    :root{
      --bg1:#ff4d6d;
      --bg2:#ff8fab;
      --card:#ffffffee;
      --text:#1f1f1f;
      --yes:#22c55e;
      --no:#ef4444;
      --soft:#00000010;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, #fff3, transparent 60%),
        radial-gradient(1200px 800px at 80% 90%, #fff2, transparent 60%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
      overflow:hidden;
      padding: env(safe-area-inset-top) env(safe-area-inset-right)
               env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    .card{
      width:min(92vw,520px);
      background:var(--card);
      border-radius:24px;
      padding: clamp(18px, 4vw, 28px) clamp(16px, 4vw, 22px);
      box-shadow: 0 24px 60px rgba(0,0,0,.22);
      position:relative;
      backdrop-filter: blur(8px);
      z-index:1;
    }

    h1{
      margin:0 0 10px 0;
      font-size: clamp(22px, 5.2vw, 34px);
      text-align:center;
      letter-spacing:.2px;
      line-height:1.15;
    }

    p{
      margin:0 0 16px 0;
      text-align:center;
      font-size: clamp(14px, 3.8vw, 16px);
      opacity:.85;
    }

    .playground{
      position:relative;
      width:100%;
      height: clamp(160px, 26vh, 260px);
      display:flex;
      justify-content:center;
      align-items:center;
      overflow:hidden;
      border-radius:18px;
      box-shadow: inset 0 0 0 2px var(--soft);
      background: #ffffff60;
    }

    button{
      border:0;
      padding: 14px 18px;
      border-radius:16px;
      font-size: 16px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(0,0,0,.12);
      transition: transform .08s ease, filter .08s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      min-height: 48px;
      min-width: 96px;
      white-space: nowrap;
    }

    button:active{
      transform: scale(.98);
      filter: brightness(.95);
    }

    #yesBtn{
      background:var(--yes);
      color:white;
      position:relative;
      z-index:2;
    }

    #noBtn{
      background:var(--no);
      color:white;
      position:absolute;
      left:0;
      top:0;
      z-index:3;
      transition: left .14s ease, top .14s ease;
      touch-action: none;
    }

    #noBtn.turnYes{
      background: var(--yes);
    }

    /* Hold progress bar */
    #noBtn.holding{
      filter: brightness(0.98);
    }
    #noBtn.holding::after{
      content:"";
      position:absolute;
      left:10px; right:10px;
      bottom:7px;
      height:5px;
      background: rgba(255,255,255,.35);
      border-radius:999px;
      overflow:hidden;
    }
    #noBtn.holding::before{
      content:"";
      position:absolute;
      left:10px;
      bottom:7px;
      height:5px;
      width: var(--hold-w, 0%);
      background: rgba(255,255,255,.95);
      border-radius:999px;
    }

    .hint{
      text-align:center;
      font-size:13px;
      opacity:.75;
      margin-top:12px;
      min-height: 18px;
    }

    /* End screen (plan picker) */
    .end{
      display:none;
      margin-top: 14px;
      padding: 14px;
      border-radius: 18px;
      background:#fff;
      box-shadow: inset 0 0 0 2px var(--soft);
    }

    .endTitle{
      text-align:center;
      font-weight:900;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .two{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 420px){
      .two{ grid-template-columns: 1fr; }
    }

.choiceBtn{
  width:100%;
  background:#fff;
  border: 2px solid var(--soft);
  box-shadow: 0 10px 18px rgba(0,0,0,.08);
  font-weight:900;

  /* add these: */
  white-space: normal;        /* allow wrapping */
  overflow-wrap: anywhere;    /* break long text if needed */
  line-height: 1.15;
  text-align: center;
  padding: 16px 14px;         /* a bit nicer for 2 lines */
}

    .panel{
      display:none;
      margin-top: 10px;
    }

    .optGrid{
      display:grid;
      gap: 10px;
      margin-top: 10px;
    }

    .opt{
      width:100%;
      text-align:left;
      background:#fff;
      border: 2px solid var(--soft);
      box-shadow: 0 10px 18px rgba(0,0,0,.06);
      font-weight:800;
      white-space: normal;
      line-height: 1.2;
    }

    .opt.selected{
      border-color: #00000030;
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
    }

    .finalBox{
      display:none;
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      background: #ffffff;
      box-shadow: inset 0 0 0 2px var(--soft);
      text-align:center;
    }
    .finalBox .line1{
      font-weight: 900;
      margin-bottom: 6px;
    }
    .smallRow{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .mini{
      min-width: 120px;
      background: #fff;
      border: 2px solid var(--soft);
      box-shadow: 0 10px 18px rgba(0,0,0,.06);
      font-weight: 900;
    }

    /* background hearts (shapes, not emojis) */
    .heart{
      position:absolute;
      width:16px; height:16px;
      transform: rotate(45deg);
      opacity:.55;
      animation: floatUp linear infinite;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.12));
      z-index:0;
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width:16px;height:16px;
      background:#fff;
      border-radius:50%;
      top:-8px; left:0;
    }
    .heart:after{ left:-8px; top:0; }
    .heart{ background:#fff; }

    @keyframes floatUp{
      from{ transform: translateY(120vh) rotate(45deg); }
      to  { transform: translateY(-30vh) rotate(45deg); }
    }

    /* confetti */
    .confetti{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      border-radius:24px;
    }
    .confetti i{
      position:absolute;
      width:10px; height:14px;
      opacity:.9;
      transform: translateY(-30px) rotate(0deg);
      animation: pop 1.2s ease-in forwards;
    }
    @keyframes pop{
      0%{ transform: translateY(-30px) rotate(0deg); opacity:0; }
      15%{ opacity:1; }
      100%{ transform: translateY(520px) rotate(520deg); opacity:0; }
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="confetti" id="confetti"></div>

    <h1 id="question">Do you want to be my Valentine?</h1>
    <p id="sub">Be honest, but choose wisely.</p>

    <div class="playground" id="playground">
      <button id="yesBtn">Yes</button>
      <button id="noBtn" aria-label="No button">No</button>
    </div>

    <div class="hint" id="hint">Try to reject me.</div>

    <!-- End screen -->
    <div class="end" id="end">
      <div class="endTitle">Choose what we do</div>

      <div class="two">
        <button class="choiceBtn" id="pickDinner">Restaurant</button>
        <button class="choiceBtn" id="pickHome">Homecooked/takeaway + movie</button>
      </div>

      <div class="panel" id="panelDinner">
        <div class="optGrid" id="dinnerOptions"></div>
      </div>

      <div class="panel" id="panelHome">
        <div class="optGrid" id="homeOptions"></div>
      </div>

      <div class="finalBox" id="finalBox">
        <div class="line1" id="finalLine1"></div>
        <div id="finalLine2" style="opacity:.85"></div>
        <div class="smallRow">
          <button class="mini" id="shareBtn">Share</button>
          <button class="mini" id="copyBtn">Copy</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== PERSONALIZE HERE (optional) ======
    const herName = "";
    const yourName = "";
    // ========================================

    // Your choices
    const restaurantOptions = [
      "Ramen",
      "Sushi",
      "Pasta",
      "Any restaurant we find"
    ];

    // Home option is fixed (homecooked) + pick a movie:
    const movieOptions = [
      "Psychopath diary",
      "I swear",
      "Skin"
    ];

    const playground = document.getElementById("playground");
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");
    const confetti = document.getElementById("confetti");

    const question = document.getElementById("question");
    const sub = document.getElementById("sub");
    const hint = document.getElementById("hint");

    const end = document.getElementById("end");
    const pickDinner = document.getElementById("pickDinner");
    const pickHome = document.getElementById("pickHome");
    const panelDinner = document.getElementById("panelDinner");
    const panelHome = document.getElementById("panelHome");
    const dinnerOptionsEl = document.getElementById("dinnerOptions");
    const homeOptionsEl = document.getElementById("homeOptions");

    const finalBox = document.getElementById("finalBox");
    const finalLine1 = document.getElementById("finalLine1");
    const finalLine2 = document.getElementById("finalLine2");
    const shareBtn = document.getElementById("shareBtn");
    const copyBtn = document.getElementById("copyBtn");

    const isCoarse = window.matchMedia && window.matchMedia("(pointer: coarse)").matches;

    // Red button stages (no emojis)
    const stages = [
      { label: "No", mode: "tap" },
      { label: "Are you sure?", mode: "tap" },
      { label: "Hold on, let's think about it.", mode: "tap" },
      { label: "Think again.", mode: "tap" },
      { label: "Are you colorblind? green = good!", mode: "tap" },
      { label: "The green button is right there.", mode: "tap" },
      { label: "Still trying to say no?", mode: "tap" },
      { label: "Lets test your will.", mode: "hold", holdMs: 8000 },
      { label: "That did not work.", mode: "tap" },
      { label: "Fine. Yes.", mode: "yes" }
    ];
    let stageIdx = 0;

    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    function getLocalRect(el){
      const pr = playground.getBoundingClientRect();
      const r = el.getBoundingClientRect();
      return {
        left: r.left - pr.left,
        top: r.top - pr.top,
        right: r.right - pr.left,
        bottom: r.bottom - pr.top,
        width: r.width,
        height: r.height
      };
    }

    function rectsOverlap(a, b){
      return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
    }

    // Edge runner positioning
    function randomEdgePosition(){
      const bw = noBtn.offsetWidth;
      const bh = noBtn.offsetHeight;

      const pad = 10;
      const minX = pad;
      const minY = pad;
      const maxX = Math.max(minX, playground.clientWidth  - bw - pad);
      const maxY = Math.max(minY, playground.clientHeight - bh - pad);

      const edge = Math.floor(Math.random() * 4);
      let x, y;

      if (edge === 0) { y = minY; x = minX + Math.random() * (maxX - minX); }
      else if (edge === 1) { x = maxX; y = minY + Math.random() * (maxY - minY); }
      else if (edge === 2) { y = maxY; x = minX + Math.random() * (maxX - minX); }
      else { x = minX; y = minY + Math.random() * (maxY - minY); }

      return { x: Math.round(clamp(x, minX, maxX)), y: Math.round(clamp(y, minY, maxY)) };
    }

    function moveNoToEdgeAvoidingYes(){
      const yes = getLocalRect(yesBtn);
      const avoid = { left: yes.left - 20, top: yes.top - 20, right: yes.right + 20, bottom: yes.bottom + 20 };

      const bw = noBtn.offsetWidth;
      const bh = noBtn.offsetHeight;

      for (let i = 0; i < 35; i++){
        const p = randomEdgePosition();
        const noLocal = { left: p.x, top: p.y, right: p.x + bw, bottom: p.y + bh };
        if (!rectsOverlap(noLocal, avoid)){
          noBtn.style.left = p.x + "px";
          noBtn.style.top  = p.y + "px";
          return;
        }
      }
      const p = randomEdgePosition();
      noBtn.style.left = p.x + "px";
      noBtn.style.top  = p.y + "px";
    }

    function setStage(idx){
      stageIdx = clamp(idx, 0, stages.length - 1);
      const s = stages[stageIdx];
      noBtn.textContent = s.label;

      if (s.mode === "yes") noBtn.classList.add("turnYes");
      else noBtn.classList.remove("turnYes");
    }

    function nextStage(){
      if (stageIdx < stages.length - 1) setStage(stageIdx + 1);
    }

    // Hold logic
    let holdTimer = null;
    let holdRAF = null;
    let holdStart = 0;
    let holdDone = false;

    function clearHold(){
      if (holdTimer) { clearTimeout(holdTimer); holdTimer = null; }
      if (holdRAF) { cancelAnimationFrame(holdRAF); holdRAF = null; }
      holdStart = 0;
      holdDone = false;
      noBtn.classList.remove("holding");
      noBtn.style.setProperty("--hold-w", "0%");
    }

    function startHold(ms){
      clearHold();
      holdDone = false;
      noBtn.classList.add("holding");
      holdStart = performance.now();

      const tick = () => {
        const t = performance.now() - holdStart;
        const pct = clamp((t / ms) * 100, 0, 100);
        noBtn.style.setProperty("--hold-w", pct.toFixed(0) + "%");
        if (pct < 100) holdRAF = requestAnimationFrame(tick);
      };
      holdRAF = requestAnimationFrame(tick);

      holdTimer = setTimeout(() => {
        holdDone = true;
        clearHold();
        nextStage();
        moveNoToEdgeAvoidingYes();
      }, ms);
    }

    // End screen state
    let chosenType = null;   // "Restaurant" | "Homecooked + movie"
    let chosenValue = null;

    function showEnd(){
      playground.style.display = "none";
      hint.style.display = "none";

      question.textContent = "There was no escape.";
      sub.textContent = herName ? `Choose what we do, ${herName}.` : "Choose what we do.";

      end.style.display = "block";
      panelDinner.style.display = "none";
      panelHome.style.display = "none";
      finalBox.style.display = "none";

      chosenType = null;
      chosenValue = null;
    }

    function renderOptions(container, list, typeLabel){
      container.innerHTML = "";
      list.forEach((txt) => {
        const b = document.createElement("button");
        b.className = "opt";
        b.textContent = txt;
        b.addEventListener("click", () => {
          [...container.querySelectorAll(".opt")].forEach(x => x.classList.remove("selected"));
          b.classList.add("selected");
          chosenType = typeLabel;
          chosenValue = txt;
          showFinal();
        });
        container.appendChild(b);
      });
    }

    function pick(type){
      if (type === "Restaurant"){
        panelDinner.style.display = "block";
        panelHome.style.display = "none";
        finalBox.style.display = "none";
      } else {
        panelHome.style.display = "block";
        panelDinner.style.display = "none";
        finalBox.style.display = "none";
      }
    }

    function buildChoiceText(){
      const from = yourName ? `From ${yourName}: ` : "";
      return `${from}I chose: ${chosenType} â€” ${chosenValue}`;
    }

    function showFinal(){
      finalLine1.textContent = `Locked in: ${chosenType}`;
      finalLine2.textContent = chosenValue;
      finalBox.style.display = "block";
    }

    // Share / copy
    shareBtn.addEventListener("click", async () => {
      if (!chosenType || !chosenValue) return;
      const text = buildChoiceText();

      if (navigator.share){
        try{
          await navigator.share({ title: "Plan", text });
          return;
        } catch (_) {}
      }
      try{
        await navigator.clipboard.writeText(text);
        shareBtn.textContent = "Copied";
        setTimeout(() => shareBtn.textContent = "Share", 900);
      } catch (_) {
        alert(text);
      }
    });

    copyBtn.addEventListener("click", async () => {
      if (!chosenType || !chosenValue) return;
      const text = buildChoiceText();
      try{
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = "Copied";
        setTimeout(() => copyBtn.textContent = "Copy", 900);
      } catch (_) {
        alert(text);
      }
    });

    // Buttons on end screen
    pickDinner.addEventListener("click", () => pick("Restaurant"));
    pickHome.addEventListener("click", () => pick("Homecooked + movie"));

    // Render options
    renderOptions(dinnerOptionsEl, restaurantOptions, "Restaurant");
    renderOptions(homeOptionsEl, movieOptions, "Homecooked + movie");

    // YES -> end screen
    yesBtn.addEventListener("click", () => {
      burstConfetti(70);
      spawnHearts(18);
      showEnd();
    });

    // NO button interactions
    function onNoAttemptStart(e){
      e.preventDefault();
      const s = stages[stageIdx];

      if (s.mode === "yes"){
        burstConfetti(70);
        spawnHearts(18);
        showEnd();
        return;
      }

      if (s.mode === "hold"){
        startHold(s.holdMs || 900);
        return;
      }

      nextStage();
      moveNoToEdgeAvoidingYes();
    }

    function onNoAttemptEnd(){
      const s = stages[stageIdx];
      if (s.mode === "hold" && !holdDone){
        clearHold();
        moveNoToEdgeAvoidingYes();
      }
    }

    // Phone-only: finger-near makes it run (no stage change)
    let lastMove = 0;
    function onPlaygroundMove(e){
      if (!isCoarse) return;

      const s = stages[stageIdx];
      if (s.mode === "hold" || s.mode === "yes") return;

      const now = Date.now();
      if (now - lastMove < 35) return;
      lastMove = now;

      const r = noBtn.getBoundingClientRect();
      const cx = r.left + r.width / 2;
      const cy = r.top + r.height / 2;
      const dist = Math.hypot(e.clientX - cx, e.clientY - cy);

      const triggerDistance = 110;
      if (dist < triggerDistance) moveNoToEdgeAvoidingYes();
    }

    noBtn.addEventListener("pointerdown", onNoAttemptStart);
    noBtn.addEventListener("pointerup", onNoAttemptEnd);
    noBtn.addEventListener("pointercancel", onNoAttemptEnd);
    playground.addEventListener("pointermove", onPlaygroundMove, { passive: true });

    // Init
    setStage(0);
    requestAnimationFrame(() => moveNoToEdgeAvoidingYes());

    window.addEventListener("resize", () => {
      clearHold();
      if (playground.style.display !== "none") moveNoToEdgeAvoidingYes();
    });

    // Confetti
    function burstConfetti(n){
      confetti.innerHTML = "";
      for(let i=0;i<n;i++){
        const piece = document.createElement("i");
        piece.style.left = (Math.random()*100) + "%";
        piece.style.animationDelay = (Math.random()*0.25) + "s";
        piece.style.width = (8 + Math.random()*8) + "px";
        piece.style.height = (10 + Math.random()*10) + "px";
        piece.style.background = `hsl(${Math.floor(Math.random()*360)}, 90%, 60%)`;
        confetti.appendChild(piece);
      }
      setTimeout(()=> confetti.innerHTML="", 1600);
    }

    // Hearts
    function spawnHearts(n){
      for(let i=0;i<n;i++){
        const heart = document.createElement("div");
        heart.className = "heart";
        const size = 10 + Math.random()*18;
        heart.style.width = size + "px";
        heart.style.height = size + "px";
        heart.style.left = (Math.random()*100) + "vw";
        heart.style.animationDuration = (6 + Math.random()*7) + "s";
        heart.style.opacity = (0.18 + Math.random()*0.5).toFixed(2);
        document.body.appendChild(heart);
        setTimeout(()=>heart.remove(), 15000);
      }
    }

    // Ambient hearts
    (function ambient(){
      const count = 14;
      for(let i=0;i<count;i++){
        const heart = document.createElement("div");
        heart.className = "heart";
        const size = 10 + Math.random()*16;
        heart.style.width = size + "px";
        heart.style.height = size + "px";
        heart.style.left = (Math.random()*100) + "vw";
        heart.style.animationDuration = (10 + Math.random()*12) + "s";
        heart.style.opacity = (0.12 + Math.random()*0.35).toFixed(2);
        heart.style.animationDelay = (Math.random()*6) + "s";
        document.body.appendChild(heart);
      }
    })();
  </script>
</body>
</html>


